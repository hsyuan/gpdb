-- ----------------------------------------------------------------------
-- Test: DPE: Various partition selection predicates
-- ----------------------------------------------------------------------
RESET ALL;
create schema gporca_partition_selector;
set search_path to gporca_partition_selector;
-- start_ignore
create language plpythonu;
-- end_ignore
create or replace function part_count(explain_query text) returns float as
$$
import re
rv = plpy.execute(explain_query)
search_text = 'Partitions scanned'
result = 0
for i in range(len(rv)):
    cur_line = rv[i]['QUERY PLAN']
    if search_text.lower() in cur_line.lower():
        p = re.compile('.+ ([\d\.]+) \(out of (\d+)\)')
        m = p.match(cur_line)
        result = result + float(m.group(1))
return result
$$
language plpythonu;
-- Check for all the different number of partition selections
DROP TABLE IF EXISTS DATE_PARTS;
NOTICE:  table "date_parts" does not exist, skipping
CREATE TABLE DATE_PARTS (id int, year int, month int, day int, region text)
DISTRIBUTED BY (id)
PARTITION BY RANGE (year)
    SUBPARTITION BY LIST (month)
       SUBPARTITION TEMPLATE (
        SUBPARTITION Q1 VALUES (1, 2, 3), 
        SUBPARTITION Q2 VALUES (4 ,5 ,6),
        SUBPARTITION Q3 VALUES (7, 8, 9),
        SUBPARTITION Q4 VALUES (10, 11, 12),
        DEFAULT SUBPARTITION other_months )
        	SUBPARTITION BY RANGE(day)
        		SUBPARTITION TEMPLATE (
        		START (1) END (31) EVERY (10), 
		        DEFAULT SUBPARTITION other_days)
( START (2002) END (2012) EVERY (1), 
  DEFAULT PARTITION outlying_years );
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q1" for table "date_parts_1_prt_outlying_years"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_outlying_years_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q1_3_prt_2" for table "date_parts_1_prt_outlying_years_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q1_3_prt_3" for table "date_parts_1_prt_outlying_years_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q1_3_prt_4" for table "date_parts_1_prt_outlying_years_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q2" for table "date_parts_1_prt_outlying_years"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_outlying_years_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q2_3_prt_2" for table "date_parts_1_prt_outlying_years_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q2_3_prt_3" for table "date_parts_1_prt_outlying_years_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q2_3_prt_4" for table "date_parts_1_prt_outlying_years_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q3" for table "date_parts_1_prt_outlying_years"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_outlying_years_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q3_3_prt_2" for table "date_parts_1_prt_outlying_years_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q3_3_prt_3" for table "date_parts_1_prt_outlying_years_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q3_3_prt_4" for table "date_parts_1_prt_outlying_years_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q4" for table "date_parts_1_prt_outlying_years"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_outlying_years_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q4_3_prt_2" for table "date_parts_1_prt_outlying_years_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q4_3_prt_3" for table "date_parts_1_prt_outlying_years_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_q4_3_prt_4" for table "date_parts_1_prt_outlying_years_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_other_months" for table "date_parts_1_prt_outlying_years"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_other_mo_3_prt_other_days" for table "date_parts_1_prt_outlying_years_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_outlying_years_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_outlying_years_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_outlying_years_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_outlying_years_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q1" for table "date_parts_1_prt_2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_2_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q1_3_prt_2" for table "date_parts_1_prt_2_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q1_3_prt_3" for table "date_parts_1_prt_2_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q1_3_prt_4" for table "date_parts_1_prt_2_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q2" for table "date_parts_1_prt_2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_2_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q2_3_prt_2" for table "date_parts_1_prt_2_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q2_3_prt_3" for table "date_parts_1_prt_2_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q2_3_prt_4" for table "date_parts_1_prt_2_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q3" for table "date_parts_1_prt_2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_2_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q3_3_prt_2" for table "date_parts_1_prt_2_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q3_3_prt_3" for table "date_parts_1_prt_2_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q3_3_prt_4" for table "date_parts_1_prt_2_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q4" for table "date_parts_1_prt_2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_2_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q4_3_prt_2" for table "date_parts_1_prt_2_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q4_3_prt_3" for table "date_parts_1_prt_2_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_q4_3_prt_4" for table "date_parts_1_prt_2_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_other_months" for table "date_parts_1_prt_2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_2_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_2_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_2_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_2_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_2_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q1" for table "date_parts_1_prt_3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_3_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q1_3_prt_2" for table "date_parts_1_prt_3_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q1_3_prt_3" for table "date_parts_1_prt_3_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q1_3_prt_4" for table "date_parts_1_prt_3_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q2" for table "date_parts_1_prt_3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_3_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q2_3_prt_2" for table "date_parts_1_prt_3_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q2_3_prt_3" for table "date_parts_1_prt_3_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q2_3_prt_4" for table "date_parts_1_prt_3_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q3" for table "date_parts_1_prt_3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_3_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q3_3_prt_2" for table "date_parts_1_prt_3_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q3_3_prt_3" for table "date_parts_1_prt_3_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q3_3_prt_4" for table "date_parts_1_prt_3_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q4" for table "date_parts_1_prt_3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_3_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q4_3_prt_2" for table "date_parts_1_prt_3_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q4_3_prt_3" for table "date_parts_1_prt_3_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_q4_3_prt_4" for table "date_parts_1_prt_3_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_other_months" for table "date_parts_1_prt_3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_3_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_3_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_3_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_3_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_3_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q1" for table "date_parts_1_prt_4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_4_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q1_3_prt_2" for table "date_parts_1_prt_4_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q1_3_prt_3" for table "date_parts_1_prt_4_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q1_3_prt_4" for table "date_parts_1_prt_4_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q2" for table "date_parts_1_prt_4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_4_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q2_3_prt_2" for table "date_parts_1_prt_4_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q2_3_prt_3" for table "date_parts_1_prt_4_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q2_3_prt_4" for table "date_parts_1_prt_4_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q3" for table "date_parts_1_prt_4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_4_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q3_3_prt_2" for table "date_parts_1_prt_4_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q3_3_prt_3" for table "date_parts_1_prt_4_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q3_3_prt_4" for table "date_parts_1_prt_4_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q4" for table "date_parts_1_prt_4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_4_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q4_3_prt_2" for table "date_parts_1_prt_4_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q4_3_prt_3" for table "date_parts_1_prt_4_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_q4_3_prt_4" for table "date_parts_1_prt_4_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_other_months" for table "date_parts_1_prt_4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_4_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_4_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_4_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_4_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_4_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q1" for table "date_parts_1_prt_5"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_5_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q1_3_prt_2" for table "date_parts_1_prt_5_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q1_3_prt_3" for table "date_parts_1_prt_5_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q1_3_prt_4" for table "date_parts_1_prt_5_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q2" for table "date_parts_1_prt_5"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_5_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q2_3_prt_2" for table "date_parts_1_prt_5_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q2_3_prt_3" for table "date_parts_1_prt_5_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q2_3_prt_4" for table "date_parts_1_prt_5_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q3" for table "date_parts_1_prt_5"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_5_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q3_3_prt_2" for table "date_parts_1_prt_5_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q3_3_prt_3" for table "date_parts_1_prt_5_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q3_3_prt_4" for table "date_parts_1_prt_5_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q4" for table "date_parts_1_prt_5"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_5_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q4_3_prt_2" for table "date_parts_1_prt_5_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q4_3_prt_3" for table "date_parts_1_prt_5_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_q4_3_prt_4" for table "date_parts_1_prt_5_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_other_months" for table "date_parts_1_prt_5"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_5_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_5_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_5_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_5_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_5_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q1" for table "date_parts_1_prt_6"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_6_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q1_3_prt_2" for table "date_parts_1_prt_6_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q1_3_prt_3" for table "date_parts_1_prt_6_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q1_3_prt_4" for table "date_parts_1_prt_6_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q2" for table "date_parts_1_prt_6"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_6_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q2_3_prt_2" for table "date_parts_1_prt_6_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q2_3_prt_3" for table "date_parts_1_prt_6_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q2_3_prt_4" for table "date_parts_1_prt_6_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q3" for table "date_parts_1_prt_6"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_6_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q3_3_prt_2" for table "date_parts_1_prt_6_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q3_3_prt_3" for table "date_parts_1_prt_6_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q3_3_prt_4" for table "date_parts_1_prt_6_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q4" for table "date_parts_1_prt_6"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_6_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q4_3_prt_2" for table "date_parts_1_prt_6_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q4_3_prt_3" for table "date_parts_1_prt_6_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_q4_3_prt_4" for table "date_parts_1_prt_6_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_other_months" for table "date_parts_1_prt_6"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_6_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_6_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_6_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_6_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_6_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q1" for table "date_parts_1_prt_7"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_7_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q1_3_prt_2" for table "date_parts_1_prt_7_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q1_3_prt_3" for table "date_parts_1_prt_7_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q1_3_prt_4" for table "date_parts_1_prt_7_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q2" for table "date_parts_1_prt_7"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_7_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q2_3_prt_2" for table "date_parts_1_prt_7_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q2_3_prt_3" for table "date_parts_1_prt_7_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q2_3_prt_4" for table "date_parts_1_prt_7_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q3" for table "date_parts_1_prt_7"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_7_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q3_3_prt_2" for table "date_parts_1_prt_7_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q3_3_prt_3" for table "date_parts_1_prt_7_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q3_3_prt_4" for table "date_parts_1_prt_7_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q4" for table "date_parts_1_prt_7"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_7_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q4_3_prt_2" for table "date_parts_1_prt_7_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q4_3_prt_3" for table "date_parts_1_prt_7_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_q4_3_prt_4" for table "date_parts_1_prt_7_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_other_months" for table "date_parts_1_prt_7"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_7_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_7_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_7_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_7_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_7_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q1" for table "date_parts_1_prt_8"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_8_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q1_3_prt_2" for table "date_parts_1_prt_8_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q1_3_prt_3" for table "date_parts_1_prt_8_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q1_3_prt_4" for table "date_parts_1_prt_8_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q2" for table "date_parts_1_prt_8"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_8_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q2_3_prt_2" for table "date_parts_1_prt_8_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q2_3_prt_3" for table "date_parts_1_prt_8_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q2_3_prt_4" for table "date_parts_1_prt_8_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q3" for table "date_parts_1_prt_8"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_8_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q3_3_prt_2" for table "date_parts_1_prt_8_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q3_3_prt_3" for table "date_parts_1_prt_8_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q3_3_prt_4" for table "date_parts_1_prt_8_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q4" for table "date_parts_1_prt_8"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_8_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q4_3_prt_2" for table "date_parts_1_prt_8_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q4_3_prt_3" for table "date_parts_1_prt_8_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_q4_3_prt_4" for table "date_parts_1_prt_8_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_other_months" for table "date_parts_1_prt_8"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_8_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_8_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_8_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_8_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_8_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q1" for table "date_parts_1_prt_9"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_9_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q1_3_prt_2" for table "date_parts_1_prt_9_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q1_3_prt_3" for table "date_parts_1_prt_9_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q1_3_prt_4" for table "date_parts_1_prt_9_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q2" for table "date_parts_1_prt_9"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_9_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q2_3_prt_2" for table "date_parts_1_prt_9_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q2_3_prt_3" for table "date_parts_1_prt_9_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q2_3_prt_4" for table "date_parts_1_prt_9_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q3" for table "date_parts_1_prt_9"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_9_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q3_3_prt_2" for table "date_parts_1_prt_9_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q3_3_prt_3" for table "date_parts_1_prt_9_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q3_3_prt_4" for table "date_parts_1_prt_9_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q4" for table "date_parts_1_prt_9"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_9_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q4_3_prt_2" for table "date_parts_1_prt_9_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q4_3_prt_3" for table "date_parts_1_prt_9_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_q4_3_prt_4" for table "date_parts_1_prt_9_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_other_months" for table "date_parts_1_prt_9"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_9_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_9_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_9_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_9_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_9_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q1" for table "date_parts_1_prt_10"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_10_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q1_3_prt_2" for table "date_parts_1_prt_10_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q1_3_prt_3" for table "date_parts_1_prt_10_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q1_3_prt_4" for table "date_parts_1_prt_10_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q2" for table "date_parts_1_prt_10"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_10_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q2_3_prt_2" for table "date_parts_1_prt_10_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q2_3_prt_3" for table "date_parts_1_prt_10_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q2_3_prt_4" for table "date_parts_1_prt_10_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q3" for table "date_parts_1_prt_10"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_10_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q3_3_prt_2" for table "date_parts_1_prt_10_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q3_3_prt_3" for table "date_parts_1_prt_10_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q3_3_prt_4" for table "date_parts_1_prt_10_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q4" for table "date_parts_1_prt_10"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_10_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q4_3_prt_2" for table "date_parts_1_prt_10_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q4_3_prt_3" for table "date_parts_1_prt_10_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_q4_3_prt_4" for table "date_parts_1_prt_10_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_other_months" for table "date_parts_1_prt_10"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_10_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_10_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_10_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_10_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_10_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11" for table "date_parts"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q1" for table "date_parts_1_prt_11"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q1_3_prt_other_days" for table "date_parts_1_prt_11_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q1_3_prt_2" for table "date_parts_1_prt_11_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q1_3_prt_3" for table "date_parts_1_prt_11_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q1_3_prt_4" for table "date_parts_1_prt_11_2_prt_q1"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q2" for table "date_parts_1_prt_11"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q2_3_prt_other_days" for table "date_parts_1_prt_11_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q2_3_prt_2" for table "date_parts_1_prt_11_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q2_3_prt_3" for table "date_parts_1_prt_11_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q2_3_prt_4" for table "date_parts_1_prt_11_2_prt_q2"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q3" for table "date_parts_1_prt_11"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q3_3_prt_other_days" for table "date_parts_1_prt_11_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q3_3_prt_2" for table "date_parts_1_prt_11_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q3_3_prt_3" for table "date_parts_1_prt_11_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q3_3_prt_4" for table "date_parts_1_prt_11_2_prt_q3"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q4" for table "date_parts_1_prt_11"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q4_3_prt_other_days" for table "date_parts_1_prt_11_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q4_3_prt_2" for table "date_parts_1_prt_11_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q4_3_prt_3" for table "date_parts_1_prt_11_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_q4_3_prt_4" for table "date_parts_1_prt_11_2_prt_q4"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_other_months" for table "date_parts_1_prt_11"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_other_months_3_prt_other_days" for table "date_parts_1_prt_11_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_other_months_3_prt_2" for table "date_parts_1_prt_11_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_other_months_3_prt_3" for table "date_parts_1_prt_11_2_prt_other_months"
NOTICE:  CREATE TABLE will create partition "date_parts_1_prt_11_2_prt_other_months_3_prt_4" for table "date_parts_1_prt_11_2_prt_other_months"
set optimizer=on; 
 
insert into DATE_PARTS select i, extract(year from dt), extract(month from dt), extract(day from dt), NULL from (select i, '2002-01-01'::date + i * interval '1 day' day as dt from generate_series(1, 3650) as i) as t;
-- Expected total parts => 11 * 1 * 4 => 44: 
-- TODO #141973839: we selected extra parts because of disjunction: 88 parts: 11 * 2 * 4
select part_count('explain analyze select * from DATE_PARTS where month between 1 and 3;');
 part_count 
------------
         88
(1 row)

-- Expected total parts => 11 * 2 * 4 => 88: 
-- TODO #141973839: we selected extra parts because of disjunction: 132 parts: 11 * 3 * 4
select part_count('explain analyze select * from DATE_PARTS where month between 1 and 4;');
 part_count 
------------
        132
(1 row)

-- Expected total parts => 1 * 2 * 4 => 8: 
-- TODO #141973839: we selected extra parts because of disjunction: 24 parts: 2 * 3 * 4
select part_count('explain analyze select * from DATE_PARTS where year = 2003 and month between 1 and 4;');
 part_count 
------------
         24
(1 row)

-- 1 :: 5 :: 4 => 20 // Only default for year
select part_count('explain analyze select * from DATE_PARTS where year = 1999;');
 part_count 
------------
         20
(1 row)

-- 11 :: 1 :: 4 => 44 // Only default for month
select part_count('explain analyze select * from DATE_PARTS where month = 13;');
 part_count 
------------
         44
(1 row)

-- 1 :: 1 :: 4 => 4 // Default for both year and month
select part_count('explain analyze select * from DATE_PARTS where year = 1999 and month = 13;');
 part_count 
------------
          4
(1 row)

-- 11 :: 5 :: 1 => 55 // Only default part for day
select part_count('explain analyze select * from DATE_PARTS where day = 40;');
 part_count 
------------
         55
(1 row)

-- General predicate
-- TODO #141973839. We expected 308 parts: (month = 1) =>   11 * 1 * 4 => 44, month > 3 => 11 * 4 * 4 => 176, month in (0, 1, 2) => 11 * 1 * 4 => 44, month is NULL => 11 * 1 * 4 => 44.
-- However, we selected 352 parts: (month = 1) =>   11 * 1 * 4 => 44, month > 3 => 11 * 4 * 4 => 176, month in (0, 1, 2) => 11 * 2 * 4 => 88, month is NULL => 11 * 1 * 4 => 44.
select part_count('explain analyze select * from DATE_PARTS where month = 1 union all select * from DATE_PARTS where month > 3 union all select * from DATE_PARTS where month in (0,1,2) union all select * from DATE_PARTS where month is null;');
 part_count 
------------
        352
(1 row)

-- Equality predicate
-- 44 partitions => 11 from year x 1 from month x 4 from days.
select part_count('explain analyze select * from DATE_PARTS where month = 3;');  -- Not working (it only produces general)
 part_count 
------------
         44
(1 row)

-- More Equality and General Predicates ---
drop table if exists foo;
NOTICE:  table "foo" does not exist, skipping
create table foo(a int, b int)
partition by list (b)
(partition p1 values(1,3), partition p2 values(4,2), default partition other);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
NOTICE:  CREATE TABLE will create partition "foo_1_prt_p1" for table "foo"
NOTICE:  CREATE TABLE will create partition "foo_1_prt_p2" for table "foo"
NOTICE:  CREATE TABLE will create partition "foo_1_prt_other" for table "foo"
-- General predicate
-- Total 6 parts. b = 1: 1 part, b > 3: 2 parts, b in (0, 1): 2 parts. b is null: 1 part
select part_count('explain analyze select * from foo where b = 1 union all select * from foo where b > 3 union all select * from foo where b in (0,1) union all select * from foo where b is null;');
 part_count 
------------
          6
(1 row)

drop table if exists pt;
NOTICE:  table "pt" does not exist, skipping
CREATE TABLE pt (id int, gender varchar(2)) 
DISTRIBUTED BY (id)
PARTITION BY LIST (gender)
( PARTITION girls VALUES ('F', NULL), 
  PARTITION boys VALUES ('M'), 
  DEFAULT PARTITION other );
NOTICE:  CREATE TABLE will create partition "pt_1_prt_girls" for table "pt"
NOTICE:  CREATE TABLE will create partition "pt_1_prt_boys" for table "pt"
NOTICE:  CREATE TABLE will create partition "pt_1_prt_other" for table "pt"
-- General filter
-- TODO #141916623. Expecting 6 parts, but optimizer plan selects 7 parts. The 6 parts breakdown is: gender = 'F': 1 part, gender < 'M': 2 parts (including default), gender in ('F', F'M'): 2 parts, gender is null => 1 part
select part_count('explain analyze select * from pt where gender = ''F'' union all select * from pt where gender < ''M'' union all select * from pt where gender in (''F'', ''FM'') union all select * from pt where gender is null;');
 part_count 
------------
          7
(1 row)

-- DML
-- Non-default part
insert into DATE_PARTS values (-1, 2004, 11, 30, NULL);
select * from date_parts_1_prt_4_2_prt_q4_3_prt_4 where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -1 | 2004 |    11 |  30 | 
(1 row)

-- Default year
insert into DATE_PARTS values (-2, 1999, 11, 30, NULL);
select * from date_parts_1_prt_outlying_years_2_prt_q4_3_prt_4 where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -2 | 1999 |    11 |  30 | 
(1 row)

-- Default month
insert into DATE_PARTS values (-3, 2004, 20, 30, NULL);
select * from date_parts_1_prt_4_2_prt_other_months where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -3 | 2004 |    20 |  30 | 
(1 row)

-- Default day
insert into DATE_PARTS values (-4, 2004, 10, 50, NULL);
select * from date_parts_1_prt_4_2_prt_q4_3_prt_other_days where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -4 | 2004 |    10 |  50 | 
(1 row)

-- Default everything
insert into DATE_PARTS values (-5, 1999, 20, 50, NULL);
select * from date_parts_1_prt_outlying_years_2_prt_other_mo_3_prt_other_days where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -5 | 1999 |    20 |  50 | 
(1 row)

-- Default month + day but not year
insert into DATE_PARTS values (-6, 2002, 20, 50, NULL);
select * from date_parts_1_prt_2_2_prt_other_months_3_prt_other_days where id < 0;
 id | year | month | day | region 
----+------+-------+-----+--------
 -6 | 2002 |    20 |  50 | 
(1 row)

-- Dropped columns with exchange
drop table if exists sales;
NOTICE:  table "sales" does not exist, skipping
CREATE TABLE sales (trans_id int, to_be_dropped1 int, date date, amount 
decimal(9,2), to_be_dropped2 int, region text) 
DISTRIBUTED BY (trans_id)
PARTITION BY RANGE (date)
SUBPARTITION BY LIST (region)
SUBPARTITION TEMPLATE
( SUBPARTITION usa VALUES ('usa'), 
  SUBPARTITION asia VALUES ('asia'), 
  SUBPARTITION europe VALUES ('europe'), 
  DEFAULT SUBPARTITION other_regions)
  (START (date '2011-01-01') INCLUSIVE
   END (date '2012-01-01') EXCLUSIVE
   EVERY (INTERVAL '1 month'), 
   DEFAULT PARTITION outlying_dates );
NOTICE:  CREATE TABLE will create partition "sales_1_prt_outlying_dates" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_outlying_dates_2_prt_usa" for table "sales_1_prt_outlying_dates"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_outlying_dates_2_prt_asia" for table "sales_1_prt_outlying_dates"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_outlying_dates_2_prt_europe" for table "sales_1_prt_outlying_dates"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_outlying_dates_2_prt_other_regions" for table "sales_1_prt_outlying_dates"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_2" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_usa" for table "sales_1_prt_2"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_asia" for table "sales_1_prt_2"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_europe" for table "sales_1_prt_2"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_other_regions" for table "sales_1_prt_2"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_3" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_usa" for table "sales_1_prt_3"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_asia" for table "sales_1_prt_3"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_europe" for table "sales_1_prt_3"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_other_regions" for table "sales_1_prt_3"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_4" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_usa" for table "sales_1_prt_4"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_asia" for table "sales_1_prt_4"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_europe" for table "sales_1_prt_4"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_other_regions" for table "sales_1_prt_4"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_5" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_usa" for table "sales_1_prt_5"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_asia" for table "sales_1_prt_5"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_europe" for table "sales_1_prt_5"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_other_regions" for table "sales_1_prt_5"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_6" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_usa" for table "sales_1_prt_6"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_asia" for table "sales_1_prt_6"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_europe" for table "sales_1_prt_6"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_other_regions" for table "sales_1_prt_6"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_7" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_usa" for table "sales_1_prt_7"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_asia" for table "sales_1_prt_7"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_europe" for table "sales_1_prt_7"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_other_regions" for table "sales_1_prt_7"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_8" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_usa" for table "sales_1_prt_8"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_asia" for table "sales_1_prt_8"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_europe" for table "sales_1_prt_8"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_other_regions" for table "sales_1_prt_8"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_9" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_usa" for table "sales_1_prt_9"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_asia" for table "sales_1_prt_9"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_europe" for table "sales_1_prt_9"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_other_regions" for table "sales_1_prt_9"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_10" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_usa" for table "sales_1_prt_10"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_asia" for table "sales_1_prt_10"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_europe" for table "sales_1_prt_10"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_other_regions" for table "sales_1_prt_10"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_11" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_usa" for table "sales_1_prt_11"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_asia" for table "sales_1_prt_11"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_europe" for table "sales_1_prt_11"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_other_regions" for table "sales_1_prt_11"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_12" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_usa" for table "sales_1_prt_12"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_asia" for table "sales_1_prt_12"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_europe" for table "sales_1_prt_12"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_other_regions" for table "sales_1_prt_12"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_13" for table "sales"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_13_2_prt_usa" for table "sales_1_prt_13"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_13_2_prt_asia" for table "sales_1_prt_13"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_13_2_prt_europe" for table "sales_1_prt_13"
NOTICE:  CREATE TABLE will create partition "sales_1_prt_13_2_prt_other_regions" for table "sales_1_prt_13"
-- This will introduce different column numbers in subsequent part tables
alter table sales drop column to_be_dropped1;
alter table sales drop column to_be_dropped2;
-- Create the exchange candidate without dropped columns
drop table if exists sales_exchange_part;
NOTICE:  table "sales_exchange_part" does not exist, skipping
create table sales_exchange_part (trans_id int, date date, amount 
decimal(9,2), region text);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'trans_id' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
-- Insert some data
insert into sales_exchange_part values(1, '2011-01-01', 10.1, 'usa');
-- Exchange
ALTER TABLE sales 
ALTER PARTITION FOR (RANK(1))
EXCHANGE PARTITION FOR ('usa') WITH TABLE sales_exchange_part ;
NOTICE:  exchanged partition "usa" of partition for rank 1 of relation "sales" with relation "sales_exchange_part"
-- TODO: #141973839. Expected 26 parts, currently selecting 39 parts. First level: 12 parts + 1 default. Second level 2 parts. Total 26 parts.
select part_count('explain analyze select * from sales where region = ''usa'' or region = ''asia'';');
 part_count 
------------
         39
(1 row)

select * from sales where region = 'usa' or region = 'asia';
 trans_id |    date    | amount | region 
----------+------------+--------+--------
        1 | 01-01-2011 |  10.10 | usa
(1 row)

-- Updating partition key
update sales set region = 'europe' where trans_id = 1;
select * from sales_1_prt_2_2_prt_europe;
 trans_id |    date    | amount | region 
----------+------------+--------+--------
        1 | 01-01-2011 |  10.10 | europe
(1 row)

select * from sales_1_prt_2_2_prt_usa;
 trans_id | date | amount | region 
----------+------+--------+--------
(0 rows)

select * from sales;
 trans_id |    date    | amount | region 
----------+------------+--------+--------
        1 | 01-01-2011 |  10.10 | europe
(1 row)

-- Distinct From
drop table if exists bar;
NOTICE:  table "bar" does not exist, skipping
CREATE TABLE bar (i INTEGER, j decimal)
partition by list (j)
subpartition by range (i) subpartition template (start(1) end(4) every(2))
(partition p1 values(0.2,2.8, NULL), partition p2 values(1.7,3.1),
partition p3 values(5.6), default partition other);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'i' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p1" for table "bar"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p1_2_prt_1" for table "bar_1_prt_p1"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p1_2_prt_2" for table "bar_1_prt_p1"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p2" for table "bar"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p2_2_prt_1" for table "bar_1_prt_p2"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p2_2_prt_2" for table "bar_1_prt_p2"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p3" for table "bar"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p3_2_prt_1" for table "bar_1_prt_p3"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_p3_2_prt_2" for table "bar_1_prt_p3"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_other" for table "bar"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_other_2_prt_1" for table "bar_1_prt_other"
NOTICE:  CREATE TABLE will create partition "bar_1_prt_other_2_prt_2" for table "bar_1_prt_other"
insert into bar values(1, 0.2); --p1
insert into bar values(1, 1.7); --p2
insert into bar values(1, 2.1); --default
insert into bar values(1, 5.6); --default
insert into bar values(1, NULL); --p1
-- In-equality
-- 8 parts: All 4 parts on first level and each will have 2 range parts 
select part_count('explain analyze select * from bar where j>0.02;');
 part_count 
------------
          8
(1 row)

-- 6 parts: Excluding 1 list parts at first level. So, 3 at first level and each has 2 at second level.
select part_count('explain analyze select * from bar where j>2.8;');
 part_count 
------------
          6
(1 row)

-- Distinct From
-- TODO: #141722947 6 parts: Everything except 1 part that contains 5.6.
select part_count('explain analyze select * from bar where j is distinct from 5.6;');
 part_count 
------------
          8
(1 row)

-- 8 parts: NULL is shared with others on p1. So, all 8 parts.
select part_count('explain analyze select * from bar where j is distinct from NULL;');
 part_count 
------------
          8
(1 row)

RESET ALL;
